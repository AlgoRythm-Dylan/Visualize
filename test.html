<!DOCTYPE html>
<head>
    <title>Visualize.js test</title>
    <style>
        #canvas{
            position:absolute;
            top:0;
            left:0;
            height:100%;
            width:100%;
        }
        #audioPlayer{
            position:absolute;
            bottom:10px;
            left:10px;
            width:calc(100% - 20px);
            opacity:0;
        }
        #audioPlayer:hover{
            opacity:1;
        }
    </style>
</head>
<body>

    <canvas id="canvas" height=300 width=500></canvas>
    <audio controls=true id="audioPlayer"></audio>

</body>
<script src="visualize.js"></script>
<script>

var audio  = document.getElementById("audioPlayer");
var canvas = document.getElementById("canvas");

var visualizer = new MusicVisualizer.Visualizer(canvas, audio);

function fullSize(canvas){
    canvas.height = canvas.offsetHeight;
    canvas.width = canvas.offsetWidth;
}

function updateVis(){
    fullSize(canvas);
    visualizer.render();
    requestAnimationFrame(updateVis);
}

updateVis();

document.body.ondragover = function(e){
    e.preventDefault();
    e.stopPropagation();
}

document.body.ondrop = function(e){
    e.preventDefault();
    e.stopPropagation();
    audio.src = URL.createObjectURL(e.dataTransfer.files[0]);
    audio.play();
}

// A couple keys cus why not

const keys = {
    BACKSPACE: 8,
    TAB: 9,
    ENTER: 13,
    RETURN: 13,
    SHIFT: 16,
    CTRL: 17,
    CONTROL: 17,
    ALT: 18,
    CAPS: 20,
    CAPSLOCK: 20,
    ESCAPE: 27,
    ESC: 27,
    SPACE: 32,
    PAGE_UP: 33,
    PAGE_DOWN: 34
}

// Key controls

document.body.onkeydown = function(e){
    if(e.keyCode == keys.SPACE){
        if(!audio.paused){
            audio.pause();
        }
        else{
            audio.play();
        }
    }
}

</script>